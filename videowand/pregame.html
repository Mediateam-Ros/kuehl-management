<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Countdown</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: black;
        }

        #countdown {
            font-size: 200px;
            color: white;
            position: fixed;
            font-weight: bold;
            top: 90%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        p {
            font-size: 60px;
            font-style: italic;
            color: white;
            position: fixed;
            top: 72%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>

<body>
    <p>Countdown bis zum Spiel:</p>
    <div id="countdown">Lädt...</div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

        const supabaseUrl = 'https://uedocrmntzzxescgmpkw.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlZG9jcm1udHp6eGVzY2dtcGt3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc1NTc0NTUsImV4cCI6MjA2MzEzMzQ1NX0.6C6OmnYBouLHTtlOAVoq4JQM-5o9j9YvIadYoKP5DC0'

        const supabase = createClient(supabaseUrl, supabaseKey);

        async function loadNextGame() {
            try {
                const heute = new Date()
                const heuteISO = heute.toISOString().split('T')[0]  // "2024-05-26"

                const { data: spiele, error: spieleError } = await supabase
                    .from('games')
                    .select('*')
                    .eq('home_team_id', 101)
                    .gte('date', heuteISO)  // heute oder später
                    .order('date', { ascending: true })
                    .limit(1)

                if (!spiele) {
                    document.getElementById("countdown").innerText = "Keine Spieldaten gefunden.";
                    return;
                }

                const nextGame = spiele[0];
                const nextGameDateTime = new Date(`${nextGame.date}T${nextGame.time}`);
                startCountdown(nextGameDateTime);

                console.log(spiele)
            } catch (spieleError) {
                console.error('Fehler beim Laden der Spieldaten:', spieleError);
                document.getElementById("countdown").innerText = 'Fehler';
            }
        }

        function startCountdown(gameDate) {
            let interval;

            function updateCountdown() {
                const now = new Date();
                const timeDifference = Math.max(0, gameDate - now);

                const totalSeconds = Math.floor(timeDifference / 1000);
                const daysRemaining = Math.floor(totalSeconds / (3600 * 24));
                const hoursRemaining = Math.floor((totalSeconds % (3600 * 24)) / 3600);
                const minutesRemaining = Math.floor((totalSeconds % 3600) / 60);
                const secondsRemaining = totalSeconds % 60;

                if (timeDifference <= 0) {
                    clearInterval(interval);
                    document.getElementById("countdown").innerText = "00:00:00";
                    return;
                }

                document.getElementById("countdown").innerText =
                    `${hoursRemaining.toString().padStart(2, '0')}:${minutesRemaining.toString().padStart(2, '0')}:${secondsRemaining.toString().padStart(2, '0')}`;
            }

            updateCountdown();
            interval = setInterval(updateCountdown, 1000);
        }

        loadNextGame();
    </script>
</body>

</html>